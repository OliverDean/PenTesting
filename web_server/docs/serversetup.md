README: Linux VM Web Server Setup Script
Overview

This script automates the setup of a Linux virtual machine (VM) that hosts a Python web server accessible on a public domain. It configures system security features, user accounts, and installs necessary software packages. Additionally, it sets up a kiosk mode with the option to bypass it using administrator credentials.
Table of Contents

    Prerequisites
    Features
    Usage Instructions
    Configuration
    Customization
    File Structure
    Notes
    Troubleshooting

Prerequisites

Before running the script, ensure that you have:

    A Linux VM: The script is designed for Debian-based distributions like Ubuntu.
    Administrator Access: You must have sudo privileges to run the script.
    Internet Connection: Required for downloading packages and updates.
    Shared Folder (Optional): If you have web server files to deploy, place them in /media/sf_web_server or adjust the SHARED_FOLDER variable.
    User Files: Prepare directories named after each user (user1, user2, user3, admin, root) in the current working directory containing files to be copied to their home directories.

Features

    System Update and Package Installation: Updates the system and installs necessary packages.
    User Account Management: Creates user accounts with specified permissions and sets passwords securely.
    File Distribution: Copies predefined files to each user's home directory and creates sample files with content.
    Encrypted Files: Generates encrypted files for users using GPG with a chosen encryption method.
    Application Setup: Sets up a Python virtual environment and configures a Python web server to run as a service.
    Firewall Configuration: Configures UFW to secure the server.
    Kiosk Mode: Sets up a kiosk user that automatically logs in and runs a browser in kiosk mode pointing to http://localhost. Users can bypass kiosk mode with valid credentials.
    Security Enhancements: Installs and configures security tools like Fail2Ban and AppArmor.
    Automated Backups: Sets up daily backups of the web server directory.
    Tool Access Management: Restricts or allows access to specific tools (e.g., vim, nano, less, more) for each user.

Usage Instructions
1. Prepare the Environment

    Ensure sudo Access: Verify that you have sudo privileges.

    Place User Files: In the current working directory, create directories named user1, user2, user3, admin, and root. Place any files you want to be copied into each user's home directory inside these folders.

    Make the Script Executable:

    bash

    chmod +x setup_script.sh

2. Run the Script

Execute the script with sudo:

bash

sudo ./setup_script.sh

3. Follow the Prompts

    Bypass Kiosk Mode: At the beginning, the script will prompt you to enter an admin username and password to decide whether to set up kiosk mode. If you wish to bypass kiosk mode setup, provide valid admin credentials.

    Set User Passwords: The script will prompt you to set passwords for each user securely.

    Encrypting User Secret Files: For each user, you will be asked to enter a passphrase to encrypt their secret file.

4. Complete the Setup

    Once the script finishes, it will prompt you to reboot the system to apply all changes:

    bash

print_msg "Setup complete. Please reboot the system to apply all changes."

Reboot the System:

bash

    sudo reboot

Configuration

You can adjust various settings by modifying the configuration section at the top of the script:

bash

# Configuration Section

# Variables
ORIGINAL_USER="${SUDO_USER:-$USER}"
WEB_SERVER_DIR="/home/$ORIGINAL_USER/web_server"
SHARED_FOLDER="/media/sf_web_server"
BACKUP_DIR="/backup"
SETUP_FILES_DIR="$(pwd)"  # Directory containing user files

# Encryption method for secret text (Options: AES256, AES192, AES128, CAST5, BLOWFISH, etc.)
ENCRYPTION_METHOD="AES256"

# User configurations
declare -A USERS_PERMISSIONS=(
    ["user1"]="novim"
    ["user2"]="nonano"
    ["user3"]="novim nonano"
    ["admin"]="sudo"
    ["root"]="sudo"
)

# List of tools to manage permissions for
MANAGED_TOOLS=("vim" "nano" "less" "more")

Adjusting Variables

    ORIGINAL_USER: The primary user who will own the web server files.
    WEB_SERVER_DIR: The directory where the web server files will be placed.
    SHARED_FOLDER: The path to the shared folder containing web server files to copy.
    BACKUP_DIR: The directory where backups will be stored.
    SETUP_FILES_DIR: The directory containing subdirectories for each user with files to copy to their home directories.

Encryption Method

    ENCRYPTION_METHOD: Change this variable to use a different encryption algorithm supported by GPG.

User Permissions

    USERS_PERMISSIONS: An associative array defining permissions for each user.
        Examples:
            "user1"="novim": Restricts user1 from using vim.
            "user2"="nonano": Restricts user2 from using nano.
            "admin"="sudo": Grants admin sudo privileges.

Managed Tools

    MANAGED_TOOLS: A list of tools for which access will be managed based on user permissions.

Customization

    Adding Users: Add new users by extending the USERS_PERMISSIONS array.

    bash

    ["newuser"]="novim nonano"

    Custom User Files: Place files in ./newuser/ to have them copied to newuser's home directory.

    Adjusting Web Server Files: Place your web server files in the shared folder specified by SHARED_FOLDER.

    Modifying Kiosk Mode: The kiosk mode setup can be adjusted in the script section that creates the .xsession file for the kiosk user.

File Structure

After running the script, the following key components will be set up:

    User Home Directories: /home/user1, /home/user2, etc., each containing:
        Documents, Downloads, Music, Pictures, Videos, Code directories.
        Sample files with content.
        Encrypted secret files (secret_user.txt.gpg).

    Web Server Directory: $WEB_SERVER_DIR
        Contains the web server files copied from the shared folder.
        Python virtual environment in venv/.

    Backup Directory: $BACKUP_DIR
        Stores backups of the web server directory.

    Startup Scripts and Services:
        /usr/local/bin/start_webserver.sh: Script to start the web server.
        /etc/systemd/system/webserver.service: Systemd service to manage the web server.

    Nginx Configuration:
        /etc/nginx/sites-available/webserver: Nginx site configuration.
        /etc/nginx/nginx.conf: Nginx main configuration file.

    Kiosk User (if enabled):
        User kiosk with auto-login configured.
        /home/kiosk/.xsession: Script to start kiosk mode.

Notes

    Security:
        Passwords are set interactively to avoid storing them in plain text.
        Users' secret files are encrypted using GPG with the specified encryption method.
        Firewall is configured to allow only necessary traffic.
        Fail2Ban is set up to protect against brute-force attacks.
        AppArmor is enabled for additional security.

    Kiosk Mode:
        If kiosk mode is set up, the system will auto-login as the kiosk user and launch Firefox in kiosk mode pointing to http://localhost.
        Users can bypass kiosk mode by entering valid credentials through a GUI prompt.

    Backups:
        A daily backup of the web server directory is scheduled via cron.
        Backups are stored in the directory specified by BACKUP_DIR.

Troubleshooting

    Permissions Issues: If users cannot access certain files or tools, check the permissions set in the script and adjust as necessary.

    Service Not Starting: If the web server service does not start, check the status using:

    bash

systemctl status webserver.service

Firewall Blocks: Ensure that UFW rules allow the necessary ports and services.

Kiosk Mode Problems: If auto-login or kiosk mode is not working, verify the LightDM configuration and the .xsession script for the kiosk user.

Package Installation Failures: If packages fail to install, ensure that your package lists are up to date and that you have an active internet connection.

bash

sudo apt-get update

Log Files: Check system logs for detailed error messages.

    System logs: /var/log/syslog
    Nginx logs: /var/log/nginx/
    Web server logs: Depends on your application setup.